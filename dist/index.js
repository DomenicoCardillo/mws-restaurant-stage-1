!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=9)}([function(e,t,n){"use strict";!function(){function t(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function n(e,n,o){var r,i=new Promise(function(i,a){t(r=e[n].apply(e,o)).then(i,a)});return i.request=r,i}function o(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})})}function r(e,t,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return n(this[t],r,arguments)})})}function i(e,t,n,o){o.forEach(function(o){o in n.prototype&&(e.prototype[o]=function(){return this[t][o].apply(this[t],arguments)})})}function a(e,t,o,r){r.forEach(function(r){r in o.prototype&&(e.prototype[r]=function(){return e=this[t],(o=n(e,r,arguments)).then(function(e){if(e)return new u(e,o.request)});var e,o})})}function s(e){this._index=e}function u(e,t){this._cursor=e,this._request=t}function c(e){this._store=e}function l(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function f(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new l(n)}function d(e){this._db=e}o(s,"_index",["name","keyPath","multiEntry","unique"]),r(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),a(s,"_index",IDBIndex,["openCursor","openKeyCursor"]),o(u,"_cursor",["direction","key","primaryKey","value"]),r(u,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(u.prototype[e]=function(){var n=this,o=arguments;return Promise.resolve().then(function(){return n._cursor[e].apply(n._cursor,o),t(n._request).then(function(e){if(e)return new u(e,n._request)})})})}),c.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},c.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},o(c,"_store",["name","keyPath","indexNames","autoIncrement"]),r(c,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),a(c,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),i(c,"_store",IDBObjectStore,["deleteIndex"]),l.prototype.objectStore=function(){return new c(this._tx.objectStore.apply(this._tx,arguments))},o(l,"_tx",["objectStoreNames","mode"]),i(l,"_tx",IDBTransaction,["abort"]),f.prototype.createObjectStore=function(){return new c(this._db.createObjectStore.apply(this._db,arguments))},o(f,"_db",["name","version","objectStoreNames"]),i(f,"_db",IDBDatabase,["deleteObjectStore","close"]),d.prototype.transaction=function(){return new l(this._db.transaction.apply(this._db,arguments))},o(d,"_db",["name","version","objectStoreNames"]),i(d,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[c,s].forEach(function(t){t.prototype[e.replace("open","iterate")]=function(){var t,n=(t=arguments,Array.prototype.slice.call(t)),o=n[n.length-1],r=this._store||this._index,i=r[e].apply(r,n.slice(0,-1));i.onsuccess=function(){o(i.result)}}})}),[s,c].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,o=[];return new Promise(function(r){n.iterateCursor(e,function(e){e?(o.push(e.value),void 0===t||o.length!=t?e.continue():r(o)):r(o)})})})});var p={open:function(e,t,o){var r=n(indexedDB,"open",[e,t]),i=r.request;return i.onupgradeneeded=function(e){o&&o(new f(i.result,e.oldVersion,i.transaction))},r.then(function(e){return new d(e)})},delete:function(e){return n(indexedDB,"deleteDatabase",[e])}};e.exports=p,e.exports.default=e.exports}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(){var e=document.createElement("script");e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCJxh3F1ux9cd7ewAaVK_wwJTGc2O2iVc8&libraries=places&callback=initMap",e.async="",e.defer="",e.type="text/javascript",document.body.appendChild(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(0),a=(o=i)&&o.__esModule?o:{default:o};var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"openIDB",value:function(){return navigator.serviceWorker?a.default.open("mws-restaurant",1,function(e){e.createObjectStore("restaurants",{keyPath:"id"})}):Promise.resolve()}},{key:"saveRestaurants",value:function(e){this.openIDB().then(function(t){if(t){var n=t.transaction("restaurants","readwrite"),o=n.objectStore("restaurants");return e.forEach(function(e){o.put(e)}),n.complete}}).then(function(){console.log("Restaurant added")})}},{key:"getRestaurants",value:function(){return this.openIDB().then(function(e){if(e)return e.transaction("restaurants").objectStore("restaurants").getAll()})}},{key:"getRestaurant",value:function(e){return this.openIDB().then(function(t){if(t)return t.transaction("restaurants").objectStore("restaurants").get(parseInt(e))})}},{key:"updateRestaurantReviews",value:function(e,t){this.openIDB().then(function(e){if(e)return e.transaction("restaurants","readwrite").objectStore("restaurants").openCursor()}).then(function n(o){if(o){if(o.value.id===e){var r=o.value;return r.reviews=t,o.update(r)}return o.continue().then(n)}})}}]),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(2),a=(o=i)&&o.__esModule?o:{default:o};var s=[],u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"fetchRestaurants",value:function(t){var n=this;this.restaurants&&this.restaurants.length?t(null,this.restaurants):a.default.getRestaurants().then(function(o){o.length?(console.log("Return indexedDB data",o),n.restaurants=o,t(null,n.restaurants)):(console.log("indexedDB empty, fetch restaurants"),fetch(e.DB_RESTAURANT_URL).then(function(e){return e.json()}).then(function(e){a.default.saveRestaurants(e),n.restaurants=e,t(null,e)}).catch(function(e){var n="Request failed. Returned status of "+e.status;t(n,null)}))})}},{key:"fetchRestaurantById",value:function(t,n){a.default.getRestaurant(t).then(function(o){o?(console.log("Return indexedDB data",o),n(null,o)):(console.log("indexedDB empty, fetch restaurant by id"),fetch(""+e.DB_RESTAURANT_URL+t).then(function(e){return e.json()}).then(function(e){n(null,e)}).catch(function(){n("Restaurant doesn't exist",null)}))})}},{key:"fetchReviewsByRestaurantId",value:function(t,n){fetch(e.DB_REVIEWS_URL+"?restaurant_id="+t).then(function(e){return e.json()}).then(function(e){a.default.updateRestaurantReviews(t,e),n(null,e)}).catch(function(){n("Reviews for this restaurant doesn't exist",null)})}},{key:"fetchRestaurantByCuisine",value:function(t,n){e.fetchRestaurants(function(e,o){if(e)n(e,null);else{var r=o.filter(function(e){return e.cuisine_type===t});n(null,r)}})}},{key:"fetchRestaurantByNeighborhood",value:function(t,n){e.fetchRestaurants(function(e,o){if(e)n(e,null);else{var r=o.filter(function(e){return e.neighborhood===t});n(null,r)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(t,n,o){e.fetchRestaurants(function(e,r){if(e)o(e,null);else{var i=r;"all"!==t&&(i=i.filter(function(e){return e.cuisine_type===t})),"all"!==n&&(i=i.filter(function(e){return e.neighborhood===n})),o(null,i)}})}},{key:"fetchNeighborhoods",value:function(t){e.fetchRestaurants(function(e,n){if(e)t(e,null);else{var o=n.map(function(e,t){return n[t].neighborhood}),r=o.filter(function(e,t){return o.indexOf(e)===t});t(null,r)}})}},{key:"fetchCuisines",value:function(t){e.fetchRestaurants(function(e,n){if(e)t(e,null);else{var o=n.map(function(e,t){return n[t].cuisine_type}),r=o.filter(function(e,t){return o.indexOf(e)===t});t(null,r)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"original",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpg";return"/img/"+t+"/"+e.photograph+"."+n}},{key:"sizedPictureForRestaurant",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=document.createElement("picture"),r=null;n.forEach(function(n){(r=document.createElement("source")).media="(min-width: "+n.minWidth+"px)",r.type="image/webp",r.dataset.srcset=e.imageUrlForRestaurant(t,n.size,"webp"),o.appendChild(r),(r=document.createElement("source")).media="(min-width: "+n.minWidth+"px)",r.type="image/jpeg",r.dataset.srcset=e.imageUrlForRestaurant(t,n.size),o.appendChild(r)});var i=document.createElement("img");return i.dataset.src=e.imageUrlForRestaurant(t),i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",i.className="b-lazy",i.alt="Restaurant photo",o.appendChild(i),o}},{key:"mapMarkerForRestaurant",value:function(t,n){return new google.maps.Marker({position:t.latlng,title:t.name,url:e.urlForRestaurant(t),map:n,animation:google.maps.Animation.DROP})}},{key:"addReview",value:function(t,n){var o={method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(t)};fetch(e.DB_REVIEWS_URL,o).then(function(e){return e.json()}).then(function(e){n(null,e)}).catch(function(e){console.log(e),n("There was an error, try again later.",null)})}},{key:"restaurants",get:function(){return s},set:function(e){s=e}},{key:"DB_RESTAURANT_URL",get:function(){return"https://restaurant-reviews-app-server.herokuapp.com/restaurants/"}},{key:"DB_REVIEWS_URL",get:function(){return"https://restaurant-reviews-app-server.herokuapp.com/reviews/"}}]),e}();t.default=u},function(e,t,n){"use strict";var o,r;"function"==typeof Symbol&&Symbol.iterator;void 0===(r="function"==typeof(o=function(){var e,t,n,o,r="src",i="srcset";return function(r){if(!document.querySelectorAll){var i=document.createStyleSheet();document.querySelectorAll=function(e,t,n,o,r){for(r=document.all,t=[],e=e.replace(/\[for\b/gi,"[htmlFor").split(","),n=e.length;n--;){for(i.addRule(e[n],"k:v"),o=r.length;o--;)r[o].currentStyle.k&&t.push(r[o]);i.removeRule(0)}return t}}var u=this,c=u._util={};c.elements=[],c.destroyed=!0,u.options=r||{},u.options.error=u.options.error||!1,u.options.offset=u.options.offset||100,u.options.root=u.options.root||document,u.options.success=u.options.success||!1,u.options.selector=u.options.selector||".b-lazy",u.options.separator=u.options.separator||"|",u.options.containerClass=u.options.container,u.options.container=!!u.options.containerClass&&document.querySelectorAll(u.options.containerClass),u.options.errorClass=u.options.errorClass||"b-error",u.options.breakpoints=u.options.breakpoints||!1,u.options.loadInvisible=u.options.loadInvisible||!1,u.options.successClass=u.options.successClass||"b-loaded",u.options.validateDelay=u.options.validateDelay||25,u.options.saveViewportOffsetDelay=u.options.saveViewportOffsetDelay||50,u.options.srcset=u.options.srcset||"data-srcset",u.options.src=e=u.options.src||"data-src",o=Element.prototype.closest,n=window.devicePixelRatio>1,(t={}).top=0-u.options.offset,t.left=0-u.options.offset,u.revalidate=function(){a(u)},u.load=function(e,t){var n=this.options;e&&void 0===e.length?l(e,t,n):E(e,function(e){l(e,t,n)})},u.destroy=function(){var e=u._util;u.options.container&&E(u.options.container,function(t){R(t,"scroll",e.validateT)}),R(window,"scroll",e.validateT),R(window,"resize",e.validateT),R(window,"resize",e.saveViewportOffsetT),e.count=0,e.elements.length=0,e.destroyed=!0},c.validateT=C(function(){s(u)},u.options.validateDelay,u),c.saveViewportOffsetT=C(function(){w(u.options.offset)},u.options.saveViewportOffsetDelay,u),w(u.options.offset),E(u.options.breakpoints,function(t){if(t.width>=window.screen.width)return e=t.src,!1}),setTimeout(function(){a(u)})};function a(e){var t=e._util;t.elements=function(e){for(var t=[],n=e.root.querySelectorAll(e.selector),o=n.length;o--;t.unshift(n[o]));return t}(e.options),t.count=t.elements.length,t.destroyed&&(t.destroyed=!1,e.options.container&&E(e.options.container,function(e){_(e,"scroll",t.validateT)}),_(window,"resize",t.saveViewportOffsetT),_(window,"resize",t.validateT),_(window,"scroll",t.validateT)),s(e)}function s(e){for(var t=e._util,n=0;n<t.count;n++){var o=t.elements[n];(u(o,e.options)||g(o,e.options.successClass))&&(e.load(o),t.elements.splice(n,1),t.count--,n--)}0===t.count&&e.destroy()}function u(e,n){var r=e.getBoundingClientRect();if(n.container&&o){var i=e.closest(n.containerClass);if(i){var a=i.getBoundingClientRect();if(c(a,t)){var s=a.top-n.offset,u=a.right+n.offset,l=a.bottom+n.offset,f=a.left-n.offset,d={top:s>t.top?s:t.top,right:u<t.right?u:t.right,bottom:l<t.bottom?l:t.bottom,left:f>t.left?f:t.left};return c(r,d)}return!1}}return c(r,t)}function c(e,t){return e.right>=t.left&&e.bottom>=t.top&&e.left<=t.right&&e.top<=t.bottom}function l(t,o,a){if(!g(t,a.successClass)&&(o||a.loadInvisible||t.offsetWidth>0&&t.offsetHeight>0)){var s=m(t,e)||m(t,a.src);if(s){var u=s.split(a.separator),c=u[n&&u.length>1?1:0],l=m(t,a.srcset),h=y(t,"img"),v=t.parentNode,w=v&&y(v,"picture");if(h||void 0===t.src){var C=new Image,A=function e(){a.error&&a.error(t,"invalid"),b(t,a.errorClass),R(C,"error",e),R(C,"load",B)},B=function e(){h?w||p(t,c,l):t.style.backgroundImage='url("'+c+'")',f(t,a),R(C,"load",e),R(C,"error",A)};w&&(C=t,E(v.getElementsByTagName("source"),function(e){d(e,i,a.srcset)})),_(C,"error",A),_(C,"load",B),p(C,c,l)}else t.src=c,f(t,a)}else y(t,"video")?(E(t.getElementsByTagName("source"),function(e){d(e,r,a.src)}),t.load(),f(t,a)):(a.error&&a.error(t,"missing"),b(t,a.errorClass))}}function f(e,t){b(e,t.successClass),t.success&&t.success(e),v(e,t.src),v(e,t.srcset),E(t.breakpoints,function(t){v(e,t.src)})}function d(e,t,n){var o=m(e,n);o&&(h(e,t,o),v(e,n))}function p(e,t,n){n&&h(e,i,n),e.src=t}function h(e,t,n){e.setAttribute(t,n)}function m(e,t){return e.getAttribute(t)}function v(e,t){e.removeAttribute(t)}function y(e,t){return e.nodeName.toLowerCase()===t}function g(e,t){return-1!==(" "+e.className+" ").indexOf(" "+t+" ")}function b(e,t){g(e,t)||(e.className+=" "+t)}function w(e){t.bottom=(window.innerHeight||document.documentElement.clientHeight)+e,t.right=(window.innerWidth||document.documentElement.clientWidth)+e}function _(e,t,n){e.attachEvent?e.attachEvent&&e.attachEvent("on"+t,n):e.addEventListener(t,n,{capture:!1,passive:!0})}function R(e,t,n){e.detachEvent?e.detachEvent&&e.detachEvent("on"+t,n):e.removeEventListener(t,n,{capture:!1,passive:!0})}function E(e,t){if(e&&t)for(var n=e.length,o=0;o<n&&!1!==t(e[o],o);o++);}function C(e,t,n){var o=0;return function(){var r=+new Date;r-o<t||(o=r,e.apply(n,arguments))}}})?o.call(t,n,t,e):o)||(e.exports=r)},,,,function(e,t,n){"use strict";var o=i(n(4)),r=i(n(3));function i(e){return e&&e.__esModule?e:{default:e}}(0,i(n(1)).default)();var a=[];window.addEventListener("load",function(){s(),c(),updateRestaurants()});var s=function(){r.default.fetchNeighborhoods(function(e,t){e?console.error(e):(self.neighborhoods=t,u())})},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,t=document.getElementById("neighborhoods-select");e.forEach(function(e){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.appendChild(n)})},c=function(){r.default.fetchCuisines(function(e,t){e?console.error(e):(self.cuisines=t,l())})},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.cuisines,t=document.getElementById("cuisines-select");e.forEach(function(e){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.appendChild(n)})};window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),document.getElementById("maincontent").classList.remove("c-main--hide-map"),google.maps.event.addListenerOnce(self.map,"tilesloaded",function(){document.querySelector("#map iframe").title="Google Maps"}),updateRestaurants()},window.updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,o=t.selectedIndex,i=e[n].value,a=t[o].value;r.default.fetchRestaurantByCuisineAndNeighborhood(i,a,function(e,t){e?console.error(e):(f(t),d())})};var f=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",a.forEach(function(e){return e.setMap(null)}),a=[],self.restaurants=e},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list");if(e.length>0)t.classList.remove("c-restaurants--not-found"),e.forEach(function(e){t.appendChild(p(e))});else{t.classList.add("c-restaurants--not-found");var n=document.createElement("article");n.innerHTML="No restaurant found, try with other filter!",n.className="c-restaurants__not-found",t.appendChild(n)}new o.default({offset:0}),"undefined"!=typeof google&&h()},p=function(e){var t=document.createElement("article");t.className="c-restaurant";var n=r.default.sizedPictureForRestaurant(e,[{size:"original",minWidth:670},{size:670,minWidth:570},{size:570,minWidth:470},{size:470,minWidth:320}]);n.className="c-restaurant__picture",t.appendChild(n);var o=document.createElement("div");o.className="c-restaurant__content";var i=document.createElement("h3");i.innerHTML=e.name,o.appendChild(i);var a=document.createElement("p");a.innerHTML=e.neighborhood,o.appendChild(a);var s=document.createElement("p");s.className="c-restaurant__address",s.innerHTML=e.address,o.appendChild(s);var u=document.createElement("a");return u.className="c-btn",u.innerHTML="View Details",u.href=r.default.urlForRestaurant(e),o.appendChild(u),t.appendChild(o),t},h=function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=r.default.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),a.push(t)})}},function(e,t,n){"use strict";n(8)}]);